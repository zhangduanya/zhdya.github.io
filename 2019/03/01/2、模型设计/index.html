<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="Tough times never last, but tough people do.">
  <meta name="author" content="Zhdya">
  <meta name="keywords" content="">
  <title>CMDB模型设计（二） ~ 不认命？就拼命！</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css">
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">

<link rel="stylesheet" href="/css/main.css">


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css">


</head>


<body>
  <header style="height: 60vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>不认命？就拼命！</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/post.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期五, 三月 1日 2019, 12:00 凌晨
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    4.6k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      21 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h3 id="一、创建项目"><a href="#一、创建项目" class="headerlink" title="一、创建项目"></a>一、创建项目</h3><p>创建Django项目cmdb，配置好settings中的语言和时区，最后新建一个app，名字就叫做assets。这些基本过程以后就不再赘述了，不熟悉的请参考教程的前面部分。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">django版本：1.11.11</span><br></pre></td></tr></table></figure>
<p>创建成功后，初始状态如下图所示：</p>
<p><img src="http://myimage.okay686.cn/okay686cn/20190302/FMQqqBKM9bRQ.png?imageslim" alt="mark"></p>
<p>二、模型设计<br>说明：本项目依然采用SQLite数据库，等下一个项目再使用Mysql。</p>
<p>模型设计是整个项目的重中之重，其它所有的内容其实都是围绕它展开的。</p>
<p>而我们设计数据模型的原则和参考依据是前一节分析的项目需求和数据分类表。</p>
<h4 id="1-资产共有数据模型"><a href="#1-资产共有数据模型" class="headerlink" title="1.资产共有数据模型"></a>1.资产共有数据模型</h4><p>打开assets/models.py文件，首先我们要设计一张资产表：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">from django.contrib.auth.models import User</span><br><span class="line"></span><br><span class="line"># Create your models here.</span><br><span class="line"></span><br><span class="line">class Asset(models.Model):</span><br><span class="line">    &quot;&quot;&quot;    所有资产的共有数据表    &quot;&quot;&quot;</span><br><span class="line">    asset_type_choice = (</span><br><span class="line">        (&apos;server&apos;, &apos;服务器&apos;),</span><br><span class="line">        (&apos;networkdevice&apos;, &apos;网络设备&apos;),</span><br><span class="line">        (&apos;storagedevice&apos;, &apos;存储设备&apos;),</span><br><span class="line">        (&apos;securitydevice&apos;, &apos;安全设备&apos;),</span><br><span class="line">        (&apos;software&apos;, &apos;软件资产&apos;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset_status = (</span><br><span class="line">        (0, &apos;在线&apos;),</span><br><span class="line">        (1, &apos;下线&apos;),</span><br><span class="line">        (2, &apos;未知&apos;),</span><br><span class="line">        (3, &apos;故障&apos;),</span><br><span class="line">        (4, &apos;备用&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset_type = models.CharField(choices=asset_type_choice, max_length=64, default=&apos;server&apos;, verbose_name=&quot;资产类型&quot;)</span><br><span class="line">    name = models.CharField(max_length=64, unique=True, verbose_name=&quot;资产名称&quot;)        ##唯一，不可重复</span><br><span class="line">    sn = models.CharField(max_length=128, unique=True, verbose_name=&quot;资产序列号&quot;)        ##唯一，不可重复</span><br><span class="line">    business_unit = models.ForeignKey(&apos;BusinessUnit&apos;, null=True, blank=True, verbose_name=&quot;所属业务线&quot;)</span><br><span class="line">    status = models.SmallIntegerField(choices=asset_status, default=0, verbose_name=&quot;设备状态&quot;)</span><br><span class="line"></span><br><span class="line">    manufacturer = models.ForeignKey(&apos;Manufacturer&apos;, null=True, blank=True, verbose_name=&quot;制造商&quot;)</span><br><span class="line">    manage_ip = models.GenericIPAddressField(null=True, blank=True, verbose_name=&quot;管理IP&quot;)</span><br><span class="line">    tags = models.ManyToManyField(&apos;Tag&apos;, blank=True, verbose_name=&quot;标签&quot;)</span><br><span class="line">    admin = models.ForeignKey(User, null=True, blank=True, verbose_name=&quot;资产管理员&quot;, related_name=&apos;admin&apos;)</span><br><span class="line">    idc = models.ForeignKey(&apos;IDC&apos;, null=True, blank=True, verbose_name=&quot;所在机房&quot;)</span><br><span class="line">    contract = models.ForeignKey(&apos;Contract&apos;, null=True, blank=True, verbose_name=&quot;合同&quot;)</span><br><span class="line"></span><br><span class="line">    purchase_day =  models.DateField(null=True, blank=True, verbose_name=&quot;购买日期&quot;)</span><br><span class="line">    expire_day = models.DateField(null=True, blank=True, verbose_name=&quot;过保日期&quot;)</span><br><span class="line">    price = models.FloatField(null=True, blank=True, verbose_name=&quot;价格&quot;)</span><br><span class="line"></span><br><span class="line">    approved_by = models.ForeignKey(User, null=True, blank=True, verbose_name=&quot;批准人&quot;, related_name=&quot;approved_by&quot;)</span><br><span class="line"></span><br><span class="line">    memo = models.TextField(null=True, blank=True, verbose_name=&quot;备注&quot;)</span><br><span class="line">    c_time = models.DateTimeField(auto_now_add=True, verbose_name=&quot;批准日期&quot;)   ##auto_add_now默认=False：储存当对象被创建时的时间，可以用来存储比如说博客什么时候创建的，后来你再更改博客，它的值也不会变。</span><br><span class="line">    m_time = models.DateTimeField(auto_now=True, verbose_name=&quot;更新日期&quot;)       ##auto_now默认=False:当对象被存储时自动将对象的时间更新为当前时间</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;&lt;%s&gt;  %s&apos; %(self.get_asset_type_display(), self.name)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &quot;资产总表&quot;</span><br><span class="line">        verbose_name_plural = &quot;资产总表&quot;</span><br><span class="line">        ordering = [&apos;-c_time&apos;]</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li>sn这个数据字段是所有资产都必须有，并且唯一不可重复的！通常来自自动收集的数据中；</li>
<li>name和sn一样，也是唯一的；</li>
<li>asset_type_choice和asset_status分别设计为两个选择类型</li>
<li>admin和approved_by是分别是当前资产的管理员和将该资产上线的审批员；</li>
<li>导入Django内置的User表，作为我们CMDB项目的用户表，用于保存管理员和审判员等人员信息；</li>
<li>asset表中的很多字段内容都无法自动获取，需要我们手动输入，比如合同、备注。</li>
</ul>
<h4 id="2-服务器模型"><a href="#2-服务器模型" class="headerlink" title="2.服务器模型"></a>2.服务器模型</h4><p>服务器作为资产的一种，而且是最主要的管理对象，包含了一些主要的信息，其模型结构如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Server(models.Model):</span><br><span class="line">    &quot;&quot;&quot;服务器设备&quot;&quot;&quot;</span><br><span class="line">    sub_asset_type_choice = (</span><br><span class="line">        (0, &apos;PC服务器&apos;),</span><br><span class="line">        (1, &apos;刀片型&apos;),</span><br><span class="line">        (2, &apos;小型机&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    created_by_choice = (</span><br><span class="line">        (&apos;auto&apos;, &apos;自动添加&apos;),</span><br><span class="line">        (&apos;manual&apos;, &apos;手动录入&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset = models.OneToOneField(&apos;Asset&apos;)       # 非常关键的一对一关联！</span><br><span class="line">    sub_asset_type = models.SmallIntegerField(choices=sub_asset_type_choice, default=1, verbose_name=&quot;服务器类型&quot;)</span><br><span class="line">    created_by = models.CharField(choices=created_by_choice, max_length=32, default=&apos;auto&apos;, verbose_name=&quot;添加方式&quot;)</span><br><span class="line">    hosted_on = models.ForeignKey(&apos;self&apos;, related_name=&apos;hosted_on_server&apos;, blank=True, null=True, verbose_name=&quot;宿主机&quot;)       ##虚拟机专用字段</span><br><span class="line">    model = models.CharField(max_length=512, blank=True, null=True, verbose_name=&quot;Raid类型&quot;)</span><br><span class="line"></span><br><span class="line">    os_type = models.CharField(&apos;操作系统类型&apos;, max_length=64, blank=True, null=True)</span><br><span class="line">    os_distribution = models.CharField(&apos;发行版本&apos;, max_length=64, blank=True, null=True)</span><br><span class="line">    os_release = models.CharField(&apos;操作系统版本&apos;, max_length=64, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s--%s--%s &lt;sn:%s&gt;&apos; %(self.asset.name, self.get_sub_asset_type_display(), self.model, self.asset.sn)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;服务器&apos;</span><br><span class="line">        verbose_name_plural = &quot;服务器&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>说明：</strong></p>
<ul>
<li>每台服务器都唯一关联着一个资产对象，因此使用OneToOneField构建了一个一对一字段，这非常重要!</li>
<li>服务器又可分为几种子类型，这里定义了三种；</li>
<li>服务器添加的方式可以分为手动和自动；</li>
<li>有些服务器是虚拟机或者docker生成的，没有物理实体，存在于宿主机中，因此需要增加一个hosted_on字段；</li>
<li>服务器有型号信息，如果硬件信息中不包含，那么指的就是主板型号；</li>
<li>Raid类型在采用了Raid的时候才有，否则为空;</li>
<li>操作系统相关信息包含类型、发行版本和具体版本。</li>
</ul>
<h3 id="3-安全、网络、存储设备和软件资产的模型"><a href="#3-安全、网络、存储设备和软件资产的模型" class="headerlink" title="3.安全、网络、存储设备和软件资产的模型"></a>3.安全、网络、存储设备和软件资产的模型</h3><p>这部分内容不是项目的主要内容，而且数据大多数不能自动收集和报告，很多都需要手工录入。我这里给出了范例，更多的数据字段，可以自行添加。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SecurityDevice(models.Model):</span><br><span class="line">    &quot;&quot;&quot;安全设备&quot;&quot;&quot;</span><br><span class="line">    sub_asset_type_choice = (</span><br><span class="line">        (0, &apos;防火墙&apos;),</span><br><span class="line">        (1, &apos;入侵检测设备&apos;),</span><br><span class="line">        (2, &apos;互联网网关&apos;),</span><br><span class="line">        (4, &apos;运维审计系统&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset = models.OneToOneField(&apos;Asset&apos;)</span><br><span class="line">    sub_asset_type = models.SmallIntegerField(choices=sub_asset_type_choice, default=0, verbose_name=&quot;安全设备类型&quot;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.asset.name + &quot;--&quot; + self.get_sub_asset_type_display() + &quot; id:%s&quot; % self.id</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;安全设备&apos;</span><br><span class="line">        verbose_name_plural = &quot;安全设备&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class StorageDevice(models.Model):</span><br><span class="line">    &quot;&quot;&quot;存储设备&quot;&quot;&quot;</span><br><span class="line">    sub_asset_type_choice = (</span><br><span class="line">        (0, &apos;磁盘阵列&apos;),</span><br><span class="line">        (1, &apos;网络存储器&apos;),</span><br><span class="line">        (2, &apos;磁带库&apos;),</span><br><span class="line">        (4, &apos;磁带机&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset = models.OneToOneField(&apos;Asset&apos;)</span><br><span class="line">    sub_asset_type = models.SmallIntegerField(choices=sub_asset_type_choice, default=0, verbose_name=&quot;存储设备类型&quot;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.asset.name + &quot;--&quot; + self.get_sub_asset_type_display() + &quot; id:%s&quot; % self.id</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;存储设备&apos;</span><br><span class="line">        verbose_name_plural = &quot;存储设备&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class NetworkDevice(models.Model):</span><br><span class="line">    &quot;&quot;&quot;网络设备&quot;&quot;&quot;</span><br><span class="line">    sub_asset_type_choice = (</span><br><span class="line">        (0, &apos;路由器&apos;),</span><br><span class="line">        (1, &apos;交换机&apos;),</span><br><span class="line">        (2, &apos;负载均衡&apos;),</span><br><span class="line">        (4, &apos;VPN设备&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset = models.OneToOneField(&apos;Asset&apos;)</span><br><span class="line">    sub_asset_type = models.SmallIntegerField(choices=sub_asset_type_choice, default=0, verbose_name=&quot;网络设备类型&quot;)</span><br><span class="line"></span><br><span class="line">    vlan_ip = models.GenericIPAddressField(blank=True, null=True, verbose_name=&quot;VLanIP&quot;)</span><br><span class="line">    intranet_ip = models.GenericIPAddressField(blank=True, null=True, verbose_name=&quot;内网IP&quot;)</span><br><span class="line"></span><br><span class="line">    model = models.CharField(max_length=128, null=True, blank=True, verbose_name=&quot;网络设备型号&quot;)</span><br><span class="line">    firmware = models.CharField(max_length=128, blank=True, null=True, verbose_name=&quot;设备固件版本&quot;)</span><br><span class="line">    port_num = models.SmallIntegerField(null=True, blank=True, verbose_name=&quot;端口个数&quot;)</span><br><span class="line">    device_detail = models.TextField(null=True, blank=True, verbose_name=&quot;详细配置&quot;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s--%s--%s &lt;sn:%s&gt;&apos; % (self.asset.name, self.get_sub_asset_type_display(), self.model, self.asset.sn)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;网络设备&apos;</span><br><span class="line">        verbose_name_plural = &quot;网络设备&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Software(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    只保存付费购买的软件</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    sub_asset_type_choice = (</span><br><span class="line">        (0, &apos;操作系统&apos;),</span><br><span class="line">        (1, &apos;办公\开发软件&apos;),</span><br><span class="line">        (2, &apos;业务软件&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    sub_asset_type = models.SmallIntegerField(choices=sub_asset_type_choice, default=0, verbose_name=&quot;软件类型&quot;)</span><br><span class="line">    license_num = models.IntegerField(default=1, verbose_name=&quot;授权数量&quot;)</span><br><span class="line">    version = models.CharField(max_length=64, unique=True, help_text=&apos;例如: CentOS release 6.7 (Final)&apos;,</span><br><span class="line">                               verbose_name=&apos;软件/系统版本&apos;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s--%s&apos; % (self.get_sub_asset_type_display(), self.version)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;软件/系统&apos;</span><br><span class="line">        verbose_name_plural = &quot;软件/系统&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>说明：</strong></p>
<ul>
<li>每台安全、网络、存储设备都通过一对一的方式唯一关联这一个资产对象。</li>
<li>通过sub_asset_type又细分设备的子类型</li>
<li>对于软件，它没有物理形体，因此无须关联一个资产对象；</li>
<li>软件只管理那些大型的收费软件，关注点是授权数量和软件版本。对于那些开源的或者免费的软件，显然不算公司的资产。</li>
</ul>
<h3 id="4-机房、制造商、业务线、合同、资产标签等数据模型"><a href="#4-机房、制造商、业务线、合同、资产标签等数据模型" class="headerlink" title="4.机房、制造商、业务线、合同、资产标签等数据模型"></a>4.机房、制造商、业务线、合同、资产标签等数据模型</h3><p>这一部分是CMDB中相关的内容，数据表建立后，可以通过手动添加。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class IDC(models.Model):</span><br><span class="line">    &quot;&quot;&quot;机房&quot;&quot;&quot;</span><br><span class="line">    name = models.CharField(max_length=64, unique=True, verbose_name=&quot;机房名称&quot;)</span><br><span class="line">    memo = models.CharField(max_length=128, blank=True, null=True, verbose_name=&apos;备注&apos;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;机房&apos;</span><br><span class="line">        verbose_name_plural = &quot;机房&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Manufacturer(models.Model):</span><br><span class="line">    &quot;&quot;&quot;厂商&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    name = models.CharField(&apos;厂商名称&apos;, max_length=64, unique=True)</span><br><span class="line">    telephone = models.CharField(&apos;支持电话&apos;, max_length=30, blank=True, null=True)</span><br><span class="line">    memo = models.CharField(&apos;备注&apos;, max_length=128, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;厂商&apos;</span><br><span class="line">        verbose_name_plural = &quot;厂商&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BusinessUnit(models.Model):</span><br><span class="line">    &quot;&quot;&quot;业务线&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    parent_unit = models.ForeignKey(&apos;self&apos;, blank=True, null=True, related_name=&apos;parent_level&apos;)</span><br><span class="line">    name = models.CharField(&apos;业务线&apos;, max_length=64, unique=True)</span><br><span class="line">    memo = models.CharField(&apos;备注&apos;, max_length=64, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;业务线&apos;</span><br><span class="line">        verbose_name_plural = &quot;业务线&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Contract(models.Model):</span><br><span class="line">    &quot;&quot;&quot;合同&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    sn = models.CharField(&apos;合同号&apos;, max_length=128, unique=True)</span><br><span class="line">    name = models.CharField(&apos;合同名称&apos;, max_length=64)</span><br><span class="line">    memo = models.TextField(&apos;备注&apos;, blank=True, null=True)</span><br><span class="line">    price = models.IntegerField(&apos;合同金额&apos;)</span><br><span class="line">    detail = models.TextField(&apos;合同详细&apos;, blank=True, null=True)</span><br><span class="line">    start_day = models.DateField(&apos;开始日期&apos;, blank=True, null=True)</span><br><span class="line">    end_day = models.DateField(&apos;失效日期&apos;, blank=True, null=True)</span><br><span class="line">    license_num = models.IntegerField(&apos;license数量&apos;, blank=True, null=True)</span><br><span class="line">    c_day = models.DateField(&apos;创建日期&apos;, auto_now_add=True)</span><br><span class="line">    m_day = models.DateField(&apos;修改日期&apos;, auto_now=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;合同&apos;</span><br><span class="line">        verbose_name_plural = &quot;合同&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Tag(models.Model):</span><br><span class="line">    &quot;&quot;&quot;标签&quot;&quot;&quot;</span><br><span class="line">    name = models.CharField(&apos;标签名&apos;, max_length=32, unique=True)</span><br><span class="line">    c_day = models.DateField(&apos;创建日期&apos;, auto_now_add=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;标签&apos;</span><br><span class="line">        verbose_name_plural = &quot;标签&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>说明：</strong></p>
<ul>
<li>机房可以有很多其它字段，比如城市、楼号、楼层和未知等等，如有需要可自行添加；</li>
<li>业务线可以有子业务线，因此使用一个外键关联自身模型；</li>
<li>合同模型主要存储财务部门关心的数据；</li>
<li>资产标签模型与资产是多对多的关系。</li>
</ul>
<h3 id="5-CPU模型"><a href="#5-CPU模型" class="headerlink" title="5.CPU模型"></a>5.CPU模型</h3><p>通常一台服务器中只能有一种CPU型号，所以这里使用OneToOneField唯一关联一个资产对象，而不是外键关系。服务器上可以有多个物理CPU，它们的型号都是一样的。每个物理CPU又可能包含多核。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class CPU(models.Model):</span><br><span class="line">    &quot;&quot;&quot;CPU组件&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    asset = models.OneToOneField(&apos;Asset&apos;)  # 设备上的cpu肯定都是一样的，所以不需要建立多个cpu数据，一条就可以，因此使用一对一。</span><br><span class="line">    cpu_model = models.CharField(&apos;CPU型号&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    cpu_count = models.PositiveSmallIntegerField(&apos;物理CPU个数&apos;, default=1)</span><br><span class="line">    cpu_core_count = models.PositiveSmallIntegerField(&apos;CPU核数&apos;, default=1)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.asset.name + &quot;:   &quot; + self.cpu_model</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;CPU&apos;</span><br><span class="line">        verbose_name_plural = &quot;CPU&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="6-RAM模型"><a href="#6-RAM模型" class="headerlink" title="6.RAM模型"></a>6.RAM模型</h3><p>某个资产中可能有多条内存，所以这里必须是外键关系。其次，内存的sn号可能无法获得，就必须通过内存所在的插槽未知来唯一确定每条内存。因此，unique_together = (‘asset’, ‘slot’)这条设置非常关键，相当于内存的主键了，每条内存数据必须包含slot字段，否则就不合法。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class RAM(models.Model):</span><br><span class="line">    &quot;&quot;&quot;内存组件&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    asset = models.ForeignKey(&apos;Asset&apos;)  # 只能通过外键关联Asset。否则不能同时关联服务器、网络设备等等。</span><br><span class="line">    sn = models.CharField(&apos;SN号&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    model = models.CharField(&apos;内存型号&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    manufacturer = models.CharField(&apos;内存制造商&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    slot = models.CharField(&apos;插槽&apos;, max_length=64)</span><br><span class="line">    capacity = models.IntegerField(&apos;内存大小(GB)&apos;, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s: %s: %s: %s&apos; % (self.asset.name, self.model, self.slot, self.capacity)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;内存&apos;</span><br><span class="line">        verbose_name_plural = &quot;内存&quot;</span><br><span class="line">        unique_together = (&apos;asset&apos;, &apos;slot&apos;)  #unique_together，也就是联合唯一，同一资产下的内存，根据插槽slot的不同，必须唯一</span><br></pre></td></tr></table></figure></p>
<h3 id="7-硬盘模型"><a href="#7-硬盘模型" class="headerlink" title="7. 硬盘模型"></a>7. 硬盘模型</h3><p>与内存相同的是，硬盘也可能有很多块，所以也是外键关系。不同的是，硬盘通常都能获取到sn号，使用sn作为唯一值比较合适，也就是unique_together = (‘asset’, ‘sn’)。硬盘有不同的接口，这里设置了4种以及unknown，可自行添加其它类别。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Disk(models.Model):</span><br><span class="line">    &quot;&quot;&quot;存储设备&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    disk_interface_type_choice = (</span><br><span class="line">        (&apos;SATA&apos;, &apos;SATA&apos;),</span><br><span class="line">        (&apos;SAS&apos;, &apos;SAS&apos;),</span><br><span class="line">        (&apos;SCSI&apos;, &apos;SCSI&apos;),</span><br><span class="line">        (&apos;SSD&apos;, &apos;SSD&apos;),</span><br><span class="line">        (&apos;unknown&apos;, &apos;unknown&apos;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    asset = models.ForeignKey(&apos;Asset&apos;)</span><br><span class="line">    sn = models.CharField(&apos;硬盘SN号&apos;, max_length=128)</span><br><span class="line">    slot = models.CharField(&apos;所在插槽位&apos;, max_length=64, blank=True, null=True)</span><br><span class="line">    model = models.CharField(&apos;磁盘型号&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    manufacturer = models.CharField(&apos;磁盘制造商&apos;, max_length=128, blank=True, null=True)</span><br><span class="line">    capacity = models.FloatField(&apos;磁盘容量(GB)&apos;, blank=True, null=True)</span><br><span class="line">    interface_type = models.CharField(&apos;接口类型&apos;, max_length=16, choices=disk_interface_type_choice, default=&apos;unknown&apos;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s:  %s:  %s:  %sGB&apos; % (self.asset.name, self.model, self.slot, self.capacity)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;硬盘&apos;</span><br><span class="line">        verbose_name_plural = &quot;硬盘&quot;</span><br><span class="line">        unique_together = (&apos;asset&apos;, &apos;sn&apos;)</span><br></pre></td></tr></table></figure></p>
<h3 id="8-网卡模型"><a href="#8-网卡模型" class="headerlink" title="8.网卡模型"></a>8.网卡模型</h3><p>一台设备中可能有很多块网卡，所以网卡与资产也是外键的关系。另外，由于虚拟机的存在，网卡的mac地址可能会发生重复，无法唯一确定某块网卡，因此通过网卡型号加mac地址的方式来唯一确定网卡。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class NIC(models.Model):</span><br><span class="line">    &quot;&quot;&quot;网卡组件&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    asset = models.ForeignKey(&apos;Asset&apos;)  # 注意要用外键</span><br><span class="line">    name = models.CharField(&apos;网卡名称&apos;, max_length=64, blank=True, null=True)</span><br><span class="line">    model = models.CharField(&apos;网卡型号&apos;, max_length=128)</span><br><span class="line">    mac = models.CharField(&apos;MAC地址&apos;, max_length=64)  # 虚拟机有可能会出现同样的mac地址</span><br><span class="line">    ip_address = models.GenericIPAddressField(&apos;IP地址&apos;, blank=True, null=True)</span><br><span class="line">    net_mask = models.CharField(&apos;掩码&apos;, max_length=64, blank=True, null=True)</span><br><span class="line">    bonding = models.CharField(&apos;绑定地址&apos;, max_length=64, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &apos;%s:  %s:  %s&apos; % (self.asset.name, self.model, self.mac)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;网卡&apos;</span><br><span class="line">        verbose_name_plural = &quot;网卡&quot;</span><br><span class="line">        unique_together = (&apos;asset&apos;, &apos;model&apos;, &apos;mac&apos;)  # 资产、型号和mac必须联合唯一。防止虚拟机中的特殊情况发生错误。</span><br></pre></td></tr></table></figure></p>
<h3 id="9-日志模型"><a href="#9-日志模型" class="headerlink" title="9.日志模型"></a>9.日志模型</h3><p>CMDB必须记录各种日志，这是毫无疑问的！我们通常要记录事件名称、类型、关联的资产、子事件、事件详情、谁导致的、发生时间。这些都很重要！</p>
<p>尤其要注意的是，事件日志不能随着关联资产的删除被一并删除，也就是我们设置on_delete=models.SET_NULL的意义！<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class EventLog(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    日志.</span><br><span class="line">    在关联对象被删除的时候，不能一并删除，需保留日志。</span><br><span class="line">    因此，on_delete=models.SET_NULL</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    name = models.CharField(&apos;事件名称&apos;, max_length=128)</span><br><span class="line">    event_type_choice = (</span><br><span class="line">        (0, &apos;其它&apos;),</span><br><span class="line">        (1, &apos;硬件变更&apos;),</span><br><span class="line">        (2, &apos;新增配件&apos;),</span><br><span class="line">        (3, &apos;设备下线&apos;),</span><br><span class="line">        (4, &apos;设备上线&apos;),</span><br><span class="line">        (5, &apos;定期维护&apos;),</span><br><span class="line">        (6, &apos;业务上线\更新\变更&apos;),</span><br><span class="line">    )</span><br><span class="line">    asset = models.ForeignKey(&apos;Asset&apos;, blank=True, null=True, on_delete=models.SET_NULL)  # 当资产审批成功时有这项数据</span><br><span class="line">    new_asset = models.ForeignKey(&apos;NewAssetApprovalZone&apos;, blank=True, null=True, on_delete=models.SET_NULL)  # 当资产审批失败时有这项数据</span><br><span class="line">    event_type = models.SmallIntegerField(&apos;事件类型&apos;, choices=event_type_choice, default=4)</span><br><span class="line">    component = models.CharField(&apos;事件子项&apos;, max_length=256, blank=True, null=True)</span><br><span class="line">    detail = models.TextField(&apos;事件详情&apos;)</span><br><span class="line">    date = models.DateTimeField(&apos;事件时间&apos;, auto_now_add=True)</span><br><span class="line">    user = models.ForeignKey(User, blank=True, null=True, verbose_name=&apos;事件执行人&apos;, on_delete=models.SET_NULL)  # 自动更新资产数据时没有执行人</span><br><span class="line">    memo = models.TextField(&apos;备注&apos;, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;事件纪录&apos;</span><br><span class="line">        verbose_name_plural = &quot;事件纪录&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="10-新资产待审批区模型"><a href="#10-新资产待审批区模型" class="headerlink" title="10.新资产待审批区模型"></a>10.新资产待审批区模型</h3><p>新资产的到来，并不能直接加入CMDB数据库中，而是要通过管理员审批后，才可以上线的。这就需要一个新资产的待审批区。在该区中，以资产的sn号作为唯一值，确定不同的资产。除了关键的包含资产所有信息的data字段，为了方便审批员查看信息，我们还设计了一些厂商、型号、内存大小、CPU类型等字段。同时，有可能出现资产还未审批，更新数据就已经发过来的情况，所以需要一个数据更新日期字段。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class NewAssetApprovalZone(models.Model):</span><br><span class="line">    &quot;&quot;&quot;新资产待审批区&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    sn = models.CharField(&apos;资产SN号&apos;, max_length=128, unique=True)  # 此字段必填</span><br><span class="line">    asset_type_choice = (</span><br><span class="line">        (&apos;server&apos;, &apos;服务器&apos;),</span><br><span class="line">        (&apos;networkdevice&apos;, &apos;网络设备&apos;),</span><br><span class="line">        (&apos;storagedevice&apos;, &apos;存储设备&apos;),</span><br><span class="line">        (&apos;securitydevice&apos;, &apos;安全设备&apos;),</span><br><span class="line">        (&apos;IDC&apos;, &apos;机房&apos;),</span><br><span class="line">        (&apos;software&apos;, &apos;软件资产&apos;),</span><br><span class="line">    )</span><br><span class="line">    asset_type = models.CharField(choices=asset_type_choice, default=&apos;server&apos;, max_length=64, blank=True, null=True,</span><br><span class="line">                                  verbose_name=&apos;资产类型&apos;)</span><br><span class="line"></span><br><span class="line">    manufacturer = models.CharField(max_length=64, blank=True, null=True, verbose_name=&apos;生产厂商&apos;)</span><br><span class="line">    model = models.CharField(max_length=128, blank=True, null=True, verbose_name=&apos;型号&apos;)</span><br><span class="line">    ram_size = models.PositiveIntegerField(blank=True, null=True, verbose_name=&apos;内存大小&apos;)</span><br><span class="line">    cpu_model = models.CharField(max_length=128, blank=True, null=True, verbose_name=&apos;CPU型号&apos;)</span><br><span class="line">    cpu_count = models.PositiveSmallIntegerField(blank=True, null=True)</span><br><span class="line">    cpu_core_count = models.PositiveSmallIntegerField(blank=True, null=True)</span><br><span class="line">    os_distribution = models.CharField(max_length=64, blank=True, null=True)</span><br><span class="line">    os_type = models.CharField(max_length=64, blank=True, null=True)</span><br><span class="line">    os_release = models.CharField(max_length=64, blank=True, null=True)</span><br><span class="line"></span><br><span class="line">    data = models.TextField(&apos;资产数据&apos;)  # 此字段必填</span><br><span class="line"></span><br><span class="line">    c_time = models.DateTimeField(&apos;汇报日期&apos;, auto_now_add=True)</span><br><span class="line">    m_time = models.DateTimeField(&apos;数据更新日期&apos;, auto_now=True)</span><br><span class="line">    approved = models.BooleanField(&apos;是否批准&apos;, default=False)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.sn</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = &apos;新上线待批准资产&apos;</span><br><span class="line">        verbose_name_plural = &quot;新上线待批准资产&quot;</span><br><span class="line">        ordering = [&apos;-c_time&apos;]</span><br></pre></td></tr></table></figure></p>
<h3 id="11-总结"><a href="#11-总结" class="headerlink" title="11.总结"></a>11.总结</h3><p>通过前面的内容，我们可以看出CMDB数据模型的设计非常复杂，我们这里还是省略了很多不太重要的部分，就这样总共都有400多行代码。其中每个模型需要保存什么字段、采用什么类型、什么关联关系、定义哪些参数、数据是否可以为空，这些都是踩过各种坑后总结出来的，不是随便就能定义的。所以，请务必详细阅读和揣摩这些模型的内容。</p>
<p>一切没有问题之后，注册app，然后makemigrations以及migrate!</p>
<p><strong>注册app：</strong></p>
<p>cmdb/settings.py<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line">    &apos;assets&apos;,   ##此处</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p><strong>创建数据库表单：</strong><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure></p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Python3">Python3</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Django">Django</a>
                
                  <a class="hover-with-bg" href="/tags/Python">Python</a>
                
                  <a class="hover-with-bg" href="/tags/CMDB">CMDB</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <!--PC和WAP自适应版-->
  <div id="SOHUCS" sid="https://zhdya.okay686.cn/2019/03/01/2、模型设计/"></div>
  <script type="text/javascript">
    (function () {
      var appid = 'cyu4TKmA0';
      var conf = '';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
        var head = document.getElementsByTagName('head')[0] || document.head || document.documentElement;
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.charset = 'utf-8';
        script.id = 'changyan_mobile_js';
        script.src = 'https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
        head.appendChild(script);
      } else {
        var loadJs = function (d, a) {
          var c = document.getElementsByTagName('head')[0] || document.head || document.documentElement;
          var b = document.createElement('script');
          b.setAttribute('type', 'text/javascript');
          b.setAttribute('charset', 'UTF-8');
          b.setAttribute('src', d);
          if (typeof a === 'function') {
            if (window.attachEvent) {
              b.onreadystatechange = function () {
                var e = b.readyState;
                if (e === 'loaded' || e === 'complete') {
                  b.onreadystatechange = null;
                  a();
                }
              };
            } else {
              b.onload = a;
            }
          }
          c.appendChild(b);
        };
        loadJs('https://changyan.sohu.com/upload/changyan.js', function () {
          window.changyan.api.config({ appid: appid, conf: conf });
        });
      }
    })(); </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    
  <!-- 备案信息 -->
  <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">苏ICP备16041225号-2</a>
  



    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/popper/popper.min.js"></script>
<script src="/lib/bootstrap/js/bootstrap.min.js"></script>
<script src="/lib/mdbootstrap/js/mdb.min.js"></script>
<script src="/js/main.js"></script>




  
    <script src="/lib/tocbot/tocbot.min.js"></script>
  
  <script src="/js/post.js"></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js"></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js"></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  ');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "CMDB模型设计（二）&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 50,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js"></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  



  <script>(function (i, s, o, g, r, a, m) {
      i['DaoVoiceObject'] = r;
      i[r] = i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        };
      i[r].l = 1 * new Date();
      a = s.createElement(o);
      m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      a.charset = 'utf-8';
      m.parentNode.insertBefore(a, m);
    })(window, document, 'script', ('https:' === document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/f304979b.js", 'daovoice');
    daovoice('init', {
      app_id: "f304979b",
    });
    daovoice('update');
  </script>





</body>
</html>
